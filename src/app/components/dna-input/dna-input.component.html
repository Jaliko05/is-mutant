<div class="bg-white rounded-xl p-8 shadow-lg max-w-2xl mx-auto">
    <div class="text-center mb-8">
        <h2 class="text-3xl font-bold text-gray-800 mb-2">Ingrese la Secuencia de ADN</h2>
        <p class="text-gray-600 text-sm">
            Ingrese cada fila de la matriz de ADN. Solo se permiten las letras A, T, C, G.
        </p>
    </div>

    <div class="flex items-center gap-4 mb-6 p-4 bg-gray-50 rounded-lg">
        <label for="matrixSize" class="font-semibold text-gray-700">
            TamaÃ±o de la matriz:
        </label>
        <select
            id="matrixSize"
            [value]="matrixSize()"
            (change)="updateMatrixSize(+$any($event.target).value)"
            class="px-4 py-2 border-2 border-gray-200 rounded-lg font-medium cursor-pointer transition-colors hover:border-blue-400 focus:outline-none focus:border-blue-500"
        >
            @for (size of availableSizes; track size) {
                <option [value]="size">{{ size }}x{{ size }}</option>
            }
        </select>
    </div>

    <div class="mb-6">
        <div class="mb-4">
            <div class="flex justify-between items-center mb-2">
                <span class="text-sm font-medium text-gray-700">Progreso de la matriz</span>
                <span class="text-sm font-semibold text-blue-600">{{ dnaSequences().length }}/{{ matrixSize() }}</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
                <div 
                    class="bg-gradient-to-r from-blue-500 to-purple-600 h-full transition-all duration-500 ease-out"
                    [style.width.%]="getProgressPercentage()"
                ></div>
            </div>
        </div>

        <div class="flex gap-2 mb-2">
            <div class="flex-1 relative">
                <input
                    type="text"
                    [value]="currentInput()"
                    (input)="currentInput.set($any($event.target).value.toUpperCase()); validateCurrentInput()"
                    (keyup.enter)="addSequence()"
                    [placeholder]="'Ej: ATGCGA (' + matrixSize() + ' caracteres)'"
                    [maxLength]="matrixSize()"
                    [disabled]="isMatrixComplete()"
                    [class]="'w-full px-4 py-3 border-2 rounded-lg font-mono text-lg tracking-wider transition-all focus:outline-none disabled:bg-gray-100 disabled:cursor-not-allowed ' + 
                            (isCurrentInputValid() ? 'border-gray-200 focus:border-blue-500' : 'border-red-300 focus:border-red-500 bg-red-50')"
                />
                @if (currentInput() && !isMatrixComplete()) {
                    <div class="absolute right-3 top-1/2 -translate-y-1/2 text-sm font-semibold"
                         [class]="currentInput().length === matrixSize() ? 'text-green-600' : 
                                 currentInput().length > matrixSize() ? 'text-red-600' : 'text-gray-400'">
                        {{ currentInput().length }}/{{ matrixSize() }}
                    </div>
                }
            </div>
            <button
                (click)="addSequence()"
                [disabled]="!currentInput() || !isCurrentInputValid() || currentInput().length !== matrixSize() || isMatrixComplete()"
                class="px-6 py-3 bg-blue-500 text-white font-semibold rounded-lg transition-all hover:bg-blue-600 hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:shadow-none"
            >
                Agregar
            </button>
        </div>

        @if (helpMessage() && currentInput()) {
            <div class="flex items-center gap-2 p-2 mb-2 bg-blue-50 border-l-4 border-blue-400 rounded text-sm text-blue-700">
                <span>{{ helpMessage() }}</span>
            </div>
        }

        @if (hasError()) {
            <div class="flex items-center gap-2 p-3 bg-red-50 border-l-4 border-red-500 text-red-700 rounded mb-2 animate-shake">
                <svg class="w-5 h-5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                </svg>
                <span>{{ errorMessage() }}</span>
            </div>
        }

        @if (!isMatrixComplete() && !hasError()) {
            <div class="flex items-center justify-between p-3 bg-gradient-to-r from-blue-50 to-purple-50 border-l-4 border-blue-500 rounded">
                <div class="flex items-center gap-2 text-sm text-blue-700">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                    </svg>
                    <span class="font-medium">Faltan {{ getRemainingSequences() }} fila(s) para completar</span>
                </div>
                <button
                    (click)="toggleHelp()"
                    class="text-blue-600 hover:text-blue-800 font-medium text-sm transition-colors"
                >
                    {{ showHelp() ? 'Ocultar ayuda' : 'Â¿Necesitas ayuda?' }}
                </button>
            </div>
        }

        <!-- Panel de ayuda -->
        @if (showHelp()) {
            <div class="mt-3 p-4 bg-white border-2 border-blue-200 rounded-lg shadow-sm animate-slideDown">
                <h4 class="font-semibold text-gray-800 mb-2">ðŸ’¡ Consejos:</h4>
                <ul class="space-y-2 text-sm text-gray-600">
                    <li class="flex items-start gap-2">
                        <span class="text-blue-500 font-bold">â€¢</span>
                        <span>Solo usa las letras <strong>A, T, C, G</strong> (bases nitrogenadas del ADN)</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <span class="text-blue-500 font-bold">â€¢</span>
                        <span>Cada fila debe tener exactamente <strong>{{ matrixSize() }} caracteres</strong></span>
                    </li>
                    <li class="flex items-start gap-2">
                        <span class="text-blue-500 font-bold">â€¢</span>
                        <span>Presiona <kbd class="px-2 py-1 bg-gray-100 border border-gray-300 rounded text-xs">Enter</kbd> para agregar rÃ¡pido</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <span class="text-blue-500 font-bold">â€¢</span>
                        <span>Usa el botÃ³n "Cargar Ejemplo" para ver un caso de mutante</span>
                    </li>
                </ul>
            </div>
        }
    </div>

    <div class="mb-6">
        <h3 class="text-xl font-bold text-gray-800 mb-4">
            Secuencias Ingresadas ({{ dnaSequences().length }}/{{ matrixSize() }})
        </h3>

        @if (dnaSequences().length === 0) {
            <p class="text-center text-gray-400 py-8 italic">
                No hay secuencias ingresadas aÃºn
            </p>
        } @else {
            <div class="flex flex-col gap-2">
                @for (sequence of dnaSequences(); track $index) {
                    <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg transition-colors hover:bg-gray-100">
                        <span class="flex items-center justify-center w-8 h-8 bg-blue-500 text-white rounded-full font-semibold text-sm">
                            {{ $index + 1 }}
                        </span>
                        <span class="flex-1 font-mono text-lg tracking-widest text-gray-800 font-semibold">
                            {{ sequence }}
                        </span>
                        <button
                            (click)="removeSequence($index)"
                            class="px-3 py-1 bg-red-500 text-white rounded transition-colors hover:bg-red-600"
                            title="Eliminar"
                        >
                            âœ•
                        </button>
                    </div>
                }
            </div>
        }
    </div>

    <div class="flex gap-4 justify-center flex-wrap">
        <button
            (click)="loadExample()"
            class="px-6 py-3 bg-gray-500 text-white font-semibold rounded-lg transition-colors hover:bg-gray-600"
        >
            Cargar Ejemplo
        </button>
        <button
            (click)="clearAll()"
            [disabled]="dnaSequences().length === 0"
            class="px-6 py-3 bg-gray-500 text-white font-semibold rounded-lg transition-colors hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed"
        >
            Limpiar Todo
        </button>
        <button
            (click)="submitDna()"
            [disabled]="!isMatrixComplete()"
            class="px-6 py-3 bg-green-500 text-white font-semibold rounded-lg transition-colors hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed"
        >
            Analizar ADN
        </button>
    </div>
</div>
